<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Nginx合集 | 许小墨のBlog</title><meta name="author" content="许小墨,1440023258@qq.com"><meta name="copyright" content="许小墨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Nginx Tomcat 产品—》中间件–》解决方案软负载：Nginx硬负载：F  采取 是什么、为什么、怎么用 的思维三部曲方式学习 一、什么是 NginxNginx (engine x) 是一个高性能的 HTTP 和反向代理 web 服务器 Nginx 是一款轻量级的 Web 服务器&#x2F;反向代理服务器及电子邮件（IMAP&#x2F;POP3）代理服务器，在 BSD-like 协议下发行"><meta property="og:type" content="article"><meta property="og:title" content="Nginx合集"><meta property="og:url" content="https://angelxyj.github.io/posts/b99b2a28.html"><meta property="og:site_name" content="许小墨のBlog"><meta property="og:description" content="Nginx Tomcat 产品—》中间件–》解决方案软负载：Nginx硬负载：F  采取 是什么、为什么、怎么用 的思维三部曲方式学习 一、什么是 NginxNginx (engine x) 是一个高性能的 HTTP 和反向代理 web 服务器 Nginx 是一款轻量级的 Web 服务器&#x2F;反向代理服务器及电子邮件（IMAP&#x2F;POP3）代理服务器，在 BSD-like 协议下发行"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://angelxyj.github.io/img/17.jpg"><meta property="article:published_time" content="2024-03-17T18:50:42.000Z"><meta property="article:modified_time" content="2024-10-01T16:38:42.908Z"><meta property="article:author" content="许小墨"><meta property="article:tag" content="运维"><meta property="article:tag" content="nginx"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://angelxyj.github.io/img/17.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://angelxyj.github.io/posts/b99b2a28.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/favicon-16x16.png"><link rel="mask-icon" href="/img/siteicon/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},noticeOutdate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!0},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: 许小墨",link:"链接: ",source:"来源: 许小墨のBlog",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体中文",cht_to_chs:"你已切换为简体中文",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Nginx合集",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-10-01 16:38:42"}</script><script>(e=>{e.saveToLocal={set:(e,t,o)=>{if(0===o)return;const a={value:t,expiry:Date.now()+864e5*o};localStorage.setItem(e,JSON.stringify(a))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!(Date.now()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},Object.keys(t).forEach((e=>{n.setAttribute(e,t[e])})),document.head.appendChild(n)})),e.getCSS=(e,t=!1)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},document.head.appendChild(n)})),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{const e=document.getElementById("loading-box"),d=document.body,o=()=>{d.style.overflow="",e.classList.add("loaded")},t=()=>{d.style.overflow="hidden",e.classList.remove("loaded")};t(),window.addEventListener("load",(()=>{o()})),document.addEventListener("pjax:send",(()=>{t()})),document.addEventListener("pjax:complete",(()=>{o()}))})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.webp" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">198</div></a><a href="/%E6%A0%87%E7%AD%BE/"><div class="headline">标签</div><div class="length-num">183</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">42</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i> <span>照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li><li><a class="site-page child" href="/poems/"><i class="fa-fw fas fa-book"></i> <span>文学鉴赏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i> <span>关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-compass"></i> <span>关于</span></a></li><li><a class="site-page child" href="/sponsor/"><i class="fa-fw fas fa-thumbs-up"></i> <span>打赏</span></a></li><li><a class="site-page child" href="/resume/"><i class="fa-fw fas fa-book"></i> <span>简历</span></a></li><li><a class="site-page child" href="/TodoList"><i class="fa-fw fab fa-internet-explorer"></i> <span>计划</span></a></li><li><a class="site-page child" href="/ChatGPT/"><i class="fa-fw fas fa-fan"></i> <span>GPT</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('/img/17.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="许小墨のBlog"><span class="site-name">许小墨のBlog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i> <span>照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li><li><a class="site-page child" href="/poems/"><i class="fa-fw fas fa-book"></i> <span>文学鉴赏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i> <span>关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-compass"></i> <span>关于</span></a></li><li><a class="site-page child" href="/sponsor/"><i class="fa-fw fas fa-thumbs-up"></i> <span>打赏</span></a></li><li><a class="site-page child" href="/resume/"><i class="fa-fw fas fa-book"></i> <span>简历</span></a></li><li><a class="site-page child" href="/TodoList"><i class="fa-fw fab fa-internet-explorer"></i> <span>计划</span></a></li><li><a class="site-page child" href="/ChatGPT/"><i class="fa-fw fas fa-fan"></i> <span>GPT</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx合集</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-17T18:50:42.000Z" title="发表于 2024-03-17 18:50:42">2024-03-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-01T16:38:42.908Z" title="更新于 2024-10-01 16:38:42">2024-10-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/">运维开发</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/Nginx/">Nginx</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Nginx合集"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><blockquote><p>Tomcat 产品—》中间件–》解决方案<br>软负载：Nginx<br>硬负载：F</p></blockquote><p>采取 <strong>是什么、为什么、怎么用</strong> 的思维三部曲方式学习</p><h2 id="一、什么是-Nginx"><a href="#一、什么是-Nginx" class="headerlink" title="一、什么是 Nginx"></a>一、什么是 Nginx</h2><p>Nginx (engine x) 是一个高性能的 <em>HTTP</em> 和<em>反向代理</em> web 服务器</p><p>Nginx 是一款<em>轻量级</em>的 <em>Web</em> 服务器&#x2F;<em>反向代理</em>服务器及<em>电子邮件</em>（IMAP&#x2F;POP3）代理服务器，在 BSD-like 协议下发行。其特点是占有内存少，<strong>并发</strong>能力强，事实上 nginx 的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用 nginx 网站用户有：**<em>百度</em><strong>、</strong><em>京东</em><strong>、</strong><em>新浪</em><strong>、</strong><em>网易</em><strong>、</strong><em>腾讯</em><strong>、</strong><em>淘宝</em>**等。</p><p><img src="/posts/b99b2a28/image1.jpg" alt="对比"></p><h2 id="二、为什么使用-Nginx？"><a href="#二、为什么使用-Nginx？" class="headerlink" title="二、为什么使用 Nginx？"></a>二、为什么使用 Nginx？</h2><p>在传统的 Web 项目中，并发量小，用户使用的少。</p><p>所以在低并发的情况下，用户可以直接访问 tomcat 服务器，然后 tomcat 服务器返回消息给用户。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户访问&lt;--&gt;Tomcat服务器</span><br></pre></td></tr></table></figure><p>而在互联网项目下，因单个 tomcat 默认并发量有限制。如果请求量过大，会产生如下问题：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Tomcat8 默认配置的最大请求数是 150 ，也就是说同时支持 150 个并发，当然了，也可以将其改大。</span><br><span class="line">当某个应用拥有 250 个以上并发的时候，应考虑应用服务器的集群。</span><br><span class="line">具体能承载多少并发，需要看硬件的配置，CPU 越多性能越高，分配给 JVM 的内存越多性能也就越高，但也会加重 GC 的负担。</span><br><span class="line">操作系统对于进程中的线程数有一定的限制：</span><br><span class="line">Windows 每个进程中的线程数不允许超过 2000</span><br><span class="line">Linux 每个进程中的线程数不允许超过 1000</span><br><span class="line">(在 Java 中每开启一个线程需要耗用 1MB 的 JVM 内存空间用于作为线程栈之用。)</span><br><span class="line"></span><br><span class="line">Tomcat的最大并发数是可以配置的，实际运用中，最大并发数与硬件性能和CPU数量都有很大关系的。</span><br><span class="line">更好的硬件，更多的处理器都会使Tomcat支持更多的并发。</span><br><span class="line">maxThreads=&quot;150&quot; 最大并发数</span><br><span class="line">minSpareThreads=&quot;10&quot;///初始化时创建的线程数</span><br><span class="line">maxSpareThreads=&quot;500&quot;///一旦创建的线程超过这个值，Tomcat就会关闭不再需要的socket线程。</span><br></pre></td></tr></table></figure><h3 id="高并发（High-Concurrency）"><a href="#高并发（High-Concurrency）" class="headerlink" title="高并发（High Concurrency）"></a>高并发（High Concurrency）</h3><p>是互联网分布式系统架构设计中必须考虑的因素之一，</p><p>它通常是指，通过设计保证系统能够同时并行处理很多请求。</p><p>高并发相关常用的一些指标有响应时间（Response Time），吞吐量（Throughput），每秒查询率 QPS（Query Per Second），并发用户数等。</p><p><strong>响应时间</strong>：系统对请求做出响应的时间。例如系统处理一个 HTTP 请求需要 200ms，这个 200ms 就是系统的响应时间。</p><p><strong>吞吐量</strong>：单位时间内处理的请求数量。</p><p><strong>QPS</strong>：每秒响应请求数。在互联网领域，这个指标和吞吐量区分的没有这么明显。</p><p><strong>并发用户数</strong>：同时承载正常使用系统功能的用户数量。</p><h3 id="高可用（High-Availability）"><a href="#高可用（High-Availability）" class="headerlink" title="高可用（High Availability）"></a>高可用（High Availability）</h3><p>通常来描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性。</p><p>(一直都能用 99.9999%)</p><h3 id="高性能"><a href="#高性能" class="headerlink" title="高性能"></a>高性能</h3><p>是指服务响应时间快，（CPU&#x2F;处理器&#x2F;内存）特别是在高并发下响应时间不会急剧增加。</p><h3 id="Nginx-特点"><a href="#Nginx-特点" class="headerlink" title="Nginx 特点"></a>Nginx 特点</h3><ul><li>高并发、高性能</li><li>可扩展性好</li><li>高可靠性</li><li>热部署</li><li>BSD 许可证</li></ul><h2 id="三、简介"><a href="#三、简介" class="headerlink" title="三、简介"></a>三、简介</h2><p><strong>Nginx (engine x)</strong> 是一款轻量级的 Web 服务器 、反向代理服务器及电子邮件（IMAP&#x2F;POP3）代理服务器。</p><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p><h3 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h3><p>是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。</p><h3 id="正向代理和反向代理区别？"><a href="#正向代理和反向代理区别？" class="headerlink" title="正向代理和反向代理区别？"></a>正向代理和反向代理区别？</h3><p><strong>正向代理，是在客户端的</strong>。比如需要访问某些国外网站，我们可能需要购买 vpn。并且 <strong>vpn 是在我们的用户浏览器端设置的</strong>(并不是在远端的服务器设置)。浏览器先访问 vpn 地址，vpn 地址转发请求，并最后将请求结果原路返回来。</p><p><img src="/posts/b99b2a28/image2.jpg" alt="正向代理"></p><p>**反向代理是作用在服务器端的，是一个虚拟 ip(VIP)**。对于用户的一个请求，会转发到多个后端处理器中的一台来处理该具体请求。</p><p><img src="/posts/b99b2a28/image3.jpg" alt="反向代理"></p><h2 id="四、Nginx-下载"><a href="#四、Nginx-下载" class="headerlink" title="四、Nginx 下载"></a>四、Nginx 下载</h2><p>官方网址： <a target="_blank" rel="noopener" href="http://nginx.org/">http://nginx.org/</a></p><p><img src="/posts/b99b2a28/image4.jpg" alt="download"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">├── conf 这是nginx所有配置文件的目录</span><br><span class="line">│ ├── fastcgi.conf fastcgi 相关参数的配置文件</span><br><span class="line">│ ├── fastcgi.conf.default fastcgi.conf 的原始备份</span><br><span class="line">│ ├── fastcgi_params fastcgi的参数文件</span><br><span class="line">│ ├── fastcgi_params.default</span><br><span class="line">│ ├── koi-utf</span><br><span class="line">│ ├── koi-win</span><br><span class="line">│ ├── mime.types 媒体类型</span><br><span class="line">│ ├── mime.types.default</span><br><span class="line">│ ├── nginx.conf nginx默认的主配置文件</span><br><span class="line">│ ├── nginx.conf.default</span><br><span class="line">│ ├── scgi_params scgi 相关参数文件</span><br><span class="line">│ ├── scgi_params.default</span><br><span class="line">│ ├── uwsgi_params uwsgi相关参数文件</span><br><span class="line">│ ├── uwsgi_params.default</span><br><span class="line">│ └── win-utf</span><br><span class="line"></span><br><span class="line">├── fastcgi_temp fastcgi临时数据目录</span><br><span class="line"></span><br><span class="line">├── html 这是编译安装时nginx的默认站点目录，类似Apache的默认站点htdocs</span><br><span class="line">│ ├── 50 x.html 错误页面优雅替代显示文件，例如：出现 502 错误时会调用此页面error_page 500 502 503 504 / 50 x.html</span><br><span class="line">│ └── index.html 默认的首页文件，index.html\index.asp\index.jsp来做网站的首页文件</span><br><span class="line"></span><br><span class="line">├── logs nginx默认的日志路径，包括错误日志及访问日志</span><br><span class="line">│ ├── access.log nginx的默认访问日志文件，使用tail -f access.log,可以实时观看网站的用户访问情况信息</span><br><span class="line">│ ├── error.log nginx的错误日志文件，如果nginx出现启动故障可以查看此文件</span><br><span class="line">│ └── nginx.pid nginx的pid文件，nginx进程启动后，会把所有进程的ID号写到此文件</span><br><span class="line"></span><br><span class="line">├── nginx-1.6.3 -&gt; /application/nginx-1.6.</span><br><span class="line">├── proxy_temp 临时目录</span><br><span class="line">├── sbin 这是nginx命令的目录，如nginx的启动命令nginx</span><br><span class="line">│ ├── nginx Nginx的启动命令nginx</span><br><span class="line">│ └── nginx.old</span><br><span class="line">├── scgi_temp 临时目录</span><br><span class="line">└── uwsgi_temp 临时目录</span><br></pre></td></tr></table></figure><h2 id="五、Nginx-安装与使用"><a href="#五、Nginx-安装与使用" class="headerlink" title="五、Nginx 安装与使用"></a>五、Nginx 安装与使用</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><blockquote><p>1 、解压文件夹</p><p>2 、双击 nginx.exe ,一闪而过，nginx 启动成功了，通过访问：<a target="_blank" rel="noopener" href="http://localhost/">http://localhost</a><br>(端口号默认 80)</p></blockquote><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>nginx 的使用比较简单，就是几条命令</p><p>常用到的命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">start nginx 启动nginx</span><br><span class="line">nginx -s stop 快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。</span><br><span class="line">nginx -s quit 平稳关闭Nginx，保存相关信息，有安排的结束web服务。</span><br><span class="line">nginx -s reload 因改变了Nginx相关配置，需要重新加载配置而重载。</span><br><span class="line">nginx -s reopen 重新打开日志文件。</span><br><span class="line">nginx -c filename 为 Nginx 指定一个配置文件，来代替缺省的。</span><br><span class="line">nginx -t 不运行，而仅仅测试配置文件。nginx 将检查配置文件的语法的正确性，并尝试打开配置文件中所引用到的文件。</span><br><span class="line">nginx -v 显示 nginx 的版本。</span><br><span class="line">nginx -V 显示 nginx 的版本，编译器版本和配置参数</span><br></pre></td></tr></table></figure><p>windows 下 需要带上 exe <code>./nginx.exe -s stop</code></p><p><strong>提示</strong></p><p>如果不想每次都敲命令，可以在 nginx 安装目录下新添一个启动批处理文件 startup.bat，双击即可运行。内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">rem 如果启动前已经启动nginx并记录下pid文件，会<span class="built_in">kill</span>指定进程</span><br><span class="line">nginx.exe - s stop</span><br><span class="line"></span><br><span class="line">rem 测试配置文件语法正确性</span><br><span class="line">nginx.exe - t - c conf/nginx.conf</span><br><span class="line"></span><br><span class="line">rem 显示版本信息</span><br><span class="line">nginx.exe - v</span><br><span class="line"></span><br><span class="line">rem 按照指定配置去启动nginx</span><br><span class="line">nginx.exe - c conf/nginx.conf</span><br></pre></td></tr></table></figure><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="安装-Nginx-源"><a href="#安装-Nginx-源" class="headerlink" title="安装 Nginx 源"></a>安装 Nginx 源</h4><p>执行以下命令:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure><p>安装该 rpm 后，我们就能在&#x2F;etc&#x2F;yum.repos.d&#x2F; 目录中看到一个名为 nginx.repo 的文件</p><p>安装完 Nginx 源后，就可以正式安装 Nginx 了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nginx</span><br></pre></td></tr></table></figure><h4 id="Nginx-默认目录"><a href="#Nginx-默认目录" class="headerlink" title="Nginx 默认目录"></a>Nginx 默认目录</h4><p>输入命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure><p>即可看到类似于如下的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: /usr/sbin/nginx /usr/lib64/nginx /etc/nginx /usr/share/nginx</span><br></pre></td></tr></table></figure><p>以下是 Nginx 的默认路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">( 1 ) Nginx配置路径：/etc/nginx/</span><br><span class="line">( 2 ) PID目录：/var/run/[nginx.pid](https://www.centos.bz/tag/nginx-pid/)</span><br><span class="line">( 3 ) 错误日志：/var/log/nginx/[error](https://www.centos.bz/tag/error/).<span class="built_in">log</span></span><br><span class="line">( 4 ) 访问日志：/var/log/nginx/access.log</span><br><span class="line">( 5 ) 默认站点目录：/usr/share/nginx/html</span><br></pre></td></tr></table></figure><p>事实上，只需知道 Nginx 配置路径，其他路径均可在&#x2F;etc&#x2F;nginx&#x2F;nginx.conf 以及&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf 中查询到</p><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p>(1) 启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure><p>(2) 测试 Nginx 配置是否正确</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure><p>(3) 优雅重启</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>(4) 查看 nginx 的进程号</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef |grep nginx</span><br></pre></td></tr></table></figure><p>(5)nginx 服务停止</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure><p>kill -9 pid 杀死进程</p><h3 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h3><h4 id="基本安装"><a href="#基本安装" class="headerlink" title="基本安装"></a>基本安装</h4><h5 id="拉取-Nginx-镜像"><a href="#拉取-Nginx-镜像" class="headerlink" title="拉取 Nginx 镜像"></a>拉取 Nginx 镜像</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:latest</span><br></pre></td></tr></table></figure><h5 id="查看本地镜像列表（即可看到-nginx"><a href="#查看本地镜像列表（即可看到-nginx" class="headerlink" title="查看本地镜像列表（即可看到 nginx)"></a>查看本地镜像列表（即可看到 nginx)</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><h5 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx-test -p 80:80 -d nginx</span><br></pre></td></tr></table></figure><blockquote><p>参数说明</p><ul><li>–name nginx-test：容器名称</li><li>-p 80:80： 端口进行映射，将本地 8080 端口映射到容器内部的 80 端口</li><li>-d nginx： 设置容器在在后台一直运行</li></ul></blockquote><h5 id="安装成功"><a href="#安装成功" class="headerlink" title="安装成功"></a>安装成功</h5><p><img src="/posts/b99b2a28/image5.jpg" alt="nginx"></p><h4 id="高级安装"><a href="#高级安装" class="headerlink" title="高级安装"></a>高级安装</h4><blockquote><p>为了更方便开发和配置，需要将 Docker 容器内的信息进行宿主机间的配置<br>docker exec -it nginx-test bash 可通过如下命令进入容器内部</p></blockquote><h5 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/nginx</span><br></pre></td></tr></table></figure><h5 id="依次在该目录下创建三个文件目录"><a href="#依次在该目录下创建三个文件目录" class="headerlink" title="依次在该目录下创建三个文件目录"></a>依次在该目录下创建三个文件目录</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建 www目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/nginx/html</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建日志目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/nginx/logs</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建配置文件目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/nginx/conf</span><br></pre></td></tr></table></figure><h5 id="拷贝配置文件"><a href="#拷贝配置文件" class="headerlink" title="拷贝配置文件"></a>拷贝配置文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 容器ID:/etc/nginx/nginx.conf /usr/local/nginx/conf</span><br><span class="line">docker <span class="built_in">cp</span> 容器ID:/etc/nginx/conf.d/ /usr/local/nginx/conf</span><br></pre></td></tr></table></figure><h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><blockquote><p>将 usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf 内容中的 include 默认路径改为当前路径</p></blockquote><p><img src="/posts/b99b2a28/image6.jpg" alt="ssh"></p><h5 id="重新创建-运行容器"><a href="#重新创建-运行容器" class="headerlink" title="重新创建&#x2F;运行容器"></a>重新创建&#x2F;运行容器</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 --name nginx-test -v /usr/local/nginx/html:/usr/share/nginx/html -v</span><br><span class="line">/usr/local/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v</span><br><span class="line">/usr/local/nginx/conf/conf.d/default.conf:/etc/nginx/conf.d/default.conf -v</span><br><span class="line">/usr/local/nginx/logs:/var/log/nginx nginx</span><br></pre></td></tr></table></figure><h5 id="测试重新访问"><a href="#测试重新访问" class="headerlink" title="测试重新访问"></a>测试重新访问</h5><p><img src="/posts/b99b2a28/image7.jpg" alt="403"></p><h3 id="Docker-compose-安装"><a href="#Docker-compose-安装" class="headerlink" title="Docker-compose 安装"></a>Docker-compose 安装</h3><h2 id="配置文件描述"><a href="#配置文件描述" class="headerlink" title="配置文件描述"></a>配置文件描述</h2><h3 id="nginx-conf-配置文件描述"><a href="#nginx-conf-配置文件描述" class="headerlink" title="nginx.conf 配置文件描述"></a>nginx.conf 配置文件描述</h3><p>nginx&#x2F;conf 目录下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">#运行用户</span><br><span class="line">user www-data;</span><br><span class="line">#启动进程,通常设置成和cpu的数量相等</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#全局错误日志及PID文件</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#工作模式及连接数上限</span><br><span class="line">events &#123;</span><br><span class="line">use epoll; #epoll是多路复用IO(I/O Multiplexing)中的一种方式,但是仅用于linux2.6以上内</span><br><span class="line">核,可以大大提高nginx的性能</span><br><span class="line">worker_connections  1024 ;#单个后台worker process进程的最大并发链接数</span><br><span class="line"># multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span><br><span class="line">http &#123;</span><br><span class="line">#设定mime类型,类型由mime.type文件定义</span><br><span class="line">include /etc/nginx/mime.types;</span><br><span class="line">default_type application/octet-stream;</span><br><span class="line">#设定日志格式</span><br><span class="line">access_log /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，</span><br><span class="line">#必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的</span><br><span class="line">uptime.</span><br><span class="line">sendfile on;</span><br><span class="line">#tcp_nopush on;</span><br><span class="line"></span><br><span class="line">#连接超时时间</span><br><span class="line">#keepalive_timeout 0;</span><br><span class="line">keepalive_timeout  65 ;</span><br><span class="line">tcp_nodelay on;</span><br><span class="line"></span><br><span class="line">#开启gzip压缩</span><br><span class="line">gzip on;</span><br><span class="line">gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;</span><br><span class="line"></span><br><span class="line">#设定请求缓冲</span><br><span class="line">client_header_buffer_size  1 k;</span><br><span class="line">large_client_header_buffers  4 4 k;</span><br><span class="line"></span><br><span class="line">include /etc/nginx/conf.d/*.conf;</span><br><span class="line">include /etc/nginx/sites-enabled/*;</span><br><span class="line"></span><br><span class="line"># 设定负载均衡的服务器列表</span><br><span class="line">upstream mysvr &#123;</span><br><span class="line"></span><br><span class="line"># weigth 参数表示权值，权值越高被分配到的几率越大 #本机上的 Squid 开启 3128 端口</span><br><span class="line">server 192.168.8.1: 3128 weight= 5 ;</span><br><span class="line">server 192.168.8.2: 80 weight= 1 ;</span><br><span class="line">server 192.168.8.3: 80 weight= 6 ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123; #监听 80 端口</span><br><span class="line">listen 80 ; #定义使用www.javaqf.com访问</span><br><span class="line">server_name [http://www.javaqf.com;](http://www.javaqf.com;)</span><br><span class="line"></span><br><span class="line"># 设定本虚拟主机的访问日志</span><br><span class="line">access_log logs/www.javaqf.com.access.log main;</span><br><span class="line"></span><br><span class="line"># 默认请求</span><br><span class="line">location / &#123;</span><br><span class="line">root /root; #定义服务器的默认网站根目录位置</span><br><span class="line">index index.php index.html index.htm; #定义首页索引文件的名称</span><br><span class="line"></span><br><span class="line">fastcgi_pass [http://www.javaqf.com;](http://www.javaqf.com;)</span><br><span class="line">fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;</span><br><span class="line">include /etc/nginx/fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 定义错误提示页面</span><br><span class="line">error_page 500 502 503 504 / 50 x.html;</span><br><span class="line">location = / 50 x.html &#123;</span><br><span class="line">root /root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 静态文件，nginx 自己处理</span><br><span class="line">location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line">root /var/www/virtual/htdocs; #过期 30 天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。</span><br><span class="line">expires 30d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># PHP 脚本请求全部转发到 FastCGI 处理. 使用 FastCGI 默认配置.</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">root /root;</span><br><span class="line">fastcgi_pass 127.0.0.1: 9000 ;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME /home/www/www$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">#设定查看 Nginx 状态的地址</span><br><span class="line">location /NginxStatus &#123;</span><br><span class="line">stub_status on;</span><br><span class="line">access_log on;</span><br><span class="line">auth_basic &quot;NginxStatus&quot;;</span><br><span class="line">auth_basic_user_file conf/htpasswd;</span><br><span class="line">&#125;</span><br><span class="line">#禁止访问 .htxxx 文件</span><br><span class="line">location ~ /\.ht &#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><p><strong>全局块配置</strong>：配置影响 nginx 全局的指令。一般有运行 nginx 服务器的用户组，nginx 进程 pid 存放路径，日志存放路径，配置文件引入，允许生成 worker process 数等</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#user nobody; #配置用户或者组，默认为nobody</span><br><span class="line">worker_processes  1 ; #允许生成的进程数，默认为 1</span><br><span class="line">#error_log logs/error.log; #制定日志路径，级别。这个设置可以放入全局块，</span><br><span class="line">#http块，server块，级别以此为:debug|info|notice|warn|error|crit|alert|emerg</span><br><span class="line">#error_log logs/error.log notice;</span><br><span class="line">#error_log logs/error.log info;</span><br><span class="line">#pid logs/nginx.pid; #指定nginx进程运行文件存放地址</span><br></pre></td></tr></table></figure><h4 id="events-块配置"><a href="#events-块配置" class="headerlink" title="events 块配置"></a>events 块配置</h4><p><strong>events 块</strong>：配置影响 nginx 服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">accept_mutex on; #设置网路连接序列化，防止惊群现象发生，默认为on</span><br><span class="line">multi_accept on; #设置一个进程是否同时接受多个网络连接，默认为off</span><br><span class="line">#use epoll; #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span><br><span class="line">worker_connections  1024 ; #最大连接数，默认为1024(早期是512)</span><br></pre></td></tr></table></figure><p><strong>max_client</strong></p><p>nginx 作为 http 服务器的时候</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">max_clients = worker_processes * worker_connections</span><br><span class="line"></span><br><span class="line">由HTTP客户端发起一个请求，创建一个到服务器指定端口（默认是 80 端口）的TCP连接。HTTP服务器则在那个端口监听客户端</span><br><span class="line">的请求。一旦收到请求，服务器会向客户端返回一个状态，比如&quot;HTTP/1.1 200 OK&quot;，以及返回的内容，如请求的文件、错误消</span><br><span class="line">息、或者其它信息。同一时刻nginx在处理客户端发送的http请求应该只是一个connection，由此可知理论上作为http web服务</span><br><span class="line">器角色的nginx能够处理的最大连接数就是最大客户端连接数。</span><br></pre></td></tr></table></figure><p>nginx 作为反向代理服务器的时候</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">max_clients = worker_processes * worker_connections/</span><br><span class="line"></span><br><span class="line">如果作为反向代理，因为浏览器默认会开启 2 个连接到server，而且Nginx还会使用fds（file descriptor）从同一个连接池</span><br><span class="line">建立连接到upstream后端。则最大连接数的计算公式需要除 4</span><br></pre></td></tr></table></figure><h4 id="http-块配置"><a href="#http-块配置" class="headerlink" title="http 块配置"></a>http 块配置</h4><p>可以嵌套多个 server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type 定义，日志自定义，是否使用 sendfile 传输文件，连接超时时间，单连接请求数等</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#配置nginx支持哪些文件扩展名与文件类型映射表。在conf/mime.types查看支持哪些类型</span><br><span class="line">include mime.types;</span><br><span class="line">#默认文件类型(流)类型，支持很多文件、图片、js/css等</span><br><span class="line">default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">#自定义格式</span><br><span class="line">log_format myFormat &#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent</span><br><span class="line">$http_referer $http_user_agent $http_x_forwarded_for&#x27;;</span><br><span class="line"></span><br><span class="line">access_log log/access.log myFormat; #combined为日志格式的默认值</span><br><span class="line">#优化参数 允许sendfile方式传输文件，开启高校效传输模式</span><br><span class="line">sendfile on;</span><br><span class="line">#tcp_nopush on; #防止网络阻塞</span><br><span class="line"></span><br><span class="line">#keepalive_timeout 0;</span><br><span class="line">keepalive_timeout  65 ; #长连接超时时间（单位秒）</span><br><span class="line"># keepalive_requests 8192; --每个连接最大请求数</span><br><span class="line">#gzip on; #开启gzip压缩</span><br></pre></td></tr></table></figure><p><code>短连接</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">连接-&gt;传输数据-&gt;关闭连接</span><br><span class="line">比如HTTP是无状态的的短链接，浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。</span><br><span class="line">因为连接后接收了数据就断开了，所以每次数据接受处理不会有联系。 这也是HTTP协议无状态的原因之一。</span><br></pre></td></tr></table></figure><p><code>长连接</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">连接-&gt;传输数据-&gt;保持连接 -&gt; 传输数据-&gt; ...........-&gt;直到一方关闭连接，多是客户端关闭连接。</span><br><span class="line">长连接指建立SOCKET连接后不管是否使用都保持连接，但安全性较差。</span><br></pre></td></tr></table></figure><p><code>HTTP/1.0 默认使用短连接，HTTP/1.1 开始默认使用长连接</code></p><h4 id="server-块配置"><a href="#server-块配置" class="headerlink" title="server 块配置"></a>server 块配置</h4><p>配置虚拟主机的相关参数，一个 http 中可以有多个 server</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#配置虚拟主机</span><br><span class="line">server &#123;</span><br><span class="line">listen 80 ; #配置监听端口</span><br><span class="line">server_name localhost; #配置服务器名</span><br><span class="line"></span><br><span class="line">#charset koi8-r; #编码格式</span><br><span class="line"></span><br><span class="line">#access_log logs/host.access.log main; //主机的访问日志（如没有，全局为准）</span><br><span class="line">#默认的匹配/请求，当访问路径中有/，会被该location匹配处理</span><br><span class="line">location / &#123;</span><br><span class="line">root html; #root是配置服务器的默认网站根目录位置，在nginx目录下html</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#error_page 404 /404.html; #配置 404 页面</span><br><span class="line"></span><br><span class="line"># redirect server error pages to the static page /50x.html</span><br><span class="line">#</span><br><span class="line">error_page 500 502 503 504 / 50 x.html; #配置50x页面</span><br><span class="line">location = / 50 x.html &#123; #精确匹配</span><br><span class="line">root html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#禁止(外网）访问 .htaccess文件</span><br><span class="line"># deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line"># concurs with nginx&#x27;s one</span><br><span class="line">#</span><br><span class="line">#location ~ /\.ht &#123;</span><br><span class="line"># deny all;</span><br><span class="line">#&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="server2-块配置"><a href="#server2-块配置" class="headerlink" title="server2 块配置"></a>server2 块配置</h4><p>和上方很类似，主要是配置另一个虚拟机信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">#</span><br><span class="line">#server &#123;</span><br><span class="line"># listen 8000;</span><br><span class="line"># listen somename:8080;</span><br><span class="line"># server_name somename alias another.alias;</span><br><span class="line"></span><br><span class="line"># location / &#123;</span><br><span class="line"># root html;</span><br><span class="line"># index index.html index.htm;</span><br><span class="line"># &#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure><h4 id="server3-块配置"><a href="#server3-块配置" class="headerlink" title="server3 块配置"></a>server3 块配置</h4><p>配置 https 服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTPS：是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。(加密)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># HTTPS server</span><br><span class="line">#</span><br><span class="line">#server &#123;</span><br><span class="line"># listen 443 ssl;</span><br><span class="line"></span><br><span class="line"># server_name localhost;</span><br><span class="line"></span><br><span class="line"># ssl_certificate cert.pem;</span><br><span class="line"># ssl_certificate_key cert.key;</span><br><span class="line"></span><br><span class="line"># ssl_session_cache shared:SSL:1m;</span><br><span class="line"># ssl_session_timeout 5m;</span><br><span class="line"></span><br><span class="line"># ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line"># ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line"># location / &#123;</span><br><span class="line"># root html;</span><br><span class="line"># index index.html index.htm;</span><br><span class="line"># &#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP与HTTPS的区别:</span><br><span class="line">1 、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。</span><br><span class="line">2 、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。</span><br><span class="line">3 、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是 80 ，后者是 443 。</span><br><span class="line">4 、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTPS的优缺点:</span><br><span class="line">优点：</span><br><span class="line">1 、使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；</span><br><span class="line">2 、HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。</span><br><span class="line">3 、HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。</span><br><span class="line">缺点：</span><br><span class="line">1 、HTTPS协议握手阶段比较费时，会使页面的加载时间延长近50%，增加10%到20%的耗电；</span><br><span class="line">2 、HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响；</span><br><span class="line">3 、SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。</span><br><span class="line">4 、SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗。</span><br><span class="line">5 、HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。</span><br></pre></td></tr></table></figure><h2 id="六、应用场景"><a href="#六、应用场景" class="headerlink" title="六、应用场景"></a>六、应用场景</h2><h3 id="需求-1-静态资源"><a href="#需求-1-静态资源" class="headerlink" title="需求 1: 静态资源"></a>需求 1: 静态资源</h3><p><strong>静态配置文件处理</strong></p><p>由于 Nginx 性能很高，对于常用的静态资源，可直接交由 Nginx 进行访问处理</p><p><strong>示例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">root D:/nginx-tomcat/exam; # /opt/static/exam /usr/local/nginx/html/exam;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Docker 示例</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">root /usr/share/nginx/html/exam; #运行时部署数据卷-v。 外部完成映射。此处需要指定的是Docker内部的目</span><br><span class="line">录</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="需求-2-：反向代理"><a href="#需求-2-：反向代理" class="headerlink" title="需求 2 ：反向代理"></a>需求 2 ：反向代理</h3><p><strong>让 nginx 进行转发，即所 谓的反向代理 访问 localhost 时转到 tomcat</strong></p><p>修改 nginx.conf 文件，查看 server 节点，相当于一个代理服务器，可以配置多个</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">listen：表示当前的代理服务器监听的端口，默认的是监听 80 端口。</span><br><span class="line">server_name：表示服务名称。</span><br><span class="line">location：表示匹配的路径，这时配置了/表示所有请求都被匹配到这里</span><br><span class="line">root：里面配置了root这时表示当匹配这个请求的路径时，将会在这个文件夹内寻找相应的文件。</span><br><span class="line">index：当没有指定主页时，默认会选择这个指定的文件，它可以有多个，并按顺序来加载，如果第一个不存在，则找第二个，依此类推</span><br><span class="line">下面的error_page是代表错误的页面，</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80 ;</span><br><span class="line">server_name localhost;</span><br><span class="line">#charset koi8-r;</span><br><span class="line">#access_log logs/host.access.log main;</span><br><span class="line">location / &#123;</span><br><span class="line">root html;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">#error_page 404</span><br></pre></td></tr></table></figure><p><strong>localhost 时转到 tomcat 时。修改两个地方</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server_name exam_xixiaomo;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://127.0.0.1: 8080 ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>proxy_pass</strong>，它表示代理路径，相当于转发，而不像之前说的 root 必须指定一个文件夹</p><h4 id="需求-3-动静分离"><a href="#需求-3-动静分离" class="headerlink" title="需求 3: 动静分离"></a>需求 3: 动静分离</h4><p>我们需要分文件类型来进行过滤，比如 jsp 直接给 tomcat 处理，因为 nginx 并不是 servlet 容器，没办法处理 JSP，而 html,js,css 这些不需要处理的，直接给 nginx 进行缓存即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">动态资源：如JSP由Tomcat或其它WEB服务器处理。</span><br><span class="line">静态资源：如图片、css、js等由nginx服务器完成。</span><br><span class="line">（动静分离充分利用各自的优势完成高性能访问）</span><br></pre></td></tr></table></figure><p>让 JSP 页面直接给 tomcat，而 html,png 等一些图片和 JS 等直接给 nginx 进行缓存</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.jsp$ &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ \.(html|js|css|images|png|gif)$ &#123;</span><br><span class="line">root D:/nginx-tomcat/apache-tomcat-8080/webapps/maven_exam;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ .*\.(html|js|css|images|png|gif|jpg|jpeg|swf|ioc|rar|zip|txt|fiv|mid|doc|ppt|xls|mp3|wma)$</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~ 表示正则匹配，后面的内容可以是正则表达式匹配</span><br><span class="line">. 点表示任意字符 \*表示一个或多个字符</span><br><span class="line">\. 是转移字符</span><br><span class="line">|表示或</span><br><span class="line">$表示结尾</span><br><span class="line">整个配置代表括号晨面的后缀请求都由 nginx 处理。</span><br></pre></td></tr></table></figure><p><strong>解决方案</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.jsp$ &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ \.(html|js|css|png|gif)$ &#123;</span><br><span class="line">root static/maven_exam; #此处在nginx 目录下创建该文件夹（存储静态资源访问）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同时，页面上方要进行 静态资源的变更：(以绝对路径方式进行访问)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/jquery-3.1.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/quiz.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>结束：nginx 对 location 访问优先是以精确优先为原则，故将精确细的请求放在前面。这样可以完成基本的动静分离配置</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.(html|js|css|png|gif)$ &#123;</span><br><span class="line">root D:/static; #可以是nginx 外部的文件</span><br><span class="line">&#125;</span><br><span class="line">location /&#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="七、集群"><a href="#七、集群" class="headerlink" title="七、集群"></a>七、集群</h2><h3 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h3><p>同一个业务，部署在多个服务器上</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将一个应用程序，部署到多台服务器上面，然后在这些服务器的前面通过负载均衡服务器来择优选择哪一台服务器去执行；(保证高可用)</span><br></pre></td></tr></table></figure><ol><li><p>进入 nginx-1.10.1conf 路径，修改配置文件 nginx.conf<br>配置服务器组，在 http{}节点之间添加 upstream 配置。（注意不要写 localhost，不然访问速度会很慢）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream nginxCluster&#123;</span><br><span class="line">server 127.0.0.1:8080; #服务器 8080</span><br><span class="line">server 127.0.0.1:8081; #服务器 8081</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在 location{}中，利用 proxy_pass 配置反向代理地址</p><p>此处“http:&#x2F;&#x2F;”不能少，后面的地址要和第一步 upstream 定义的名称保持一致</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /&#123;</span><br><span class="line">proxy_pass http://nginxCluster;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意</p><ul><li><p>upstream 中的 server 元素必须要注意，不能加 http:&#x2F;&#x2F;，但 proxy_pass 中必须加</p></li><li><p>proxy_pass，它表示代理路径，相当于转发，而不像之前说的 root 必须指定一个文件夹</p></li></ul></li></ol><h3 id="完整如下"><a href="#完整如下" class="headerlink" title="完整如下"></a>完整如下</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">upstream nginxCluster&#123;</span><br><span class="line">server 127.0.0.1:8080; #服务器 8080</span><br><span class="line">server 127.0.0.1:8081; #服务器 .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost;</span><br><span class="line">#charset koi8-r;</span><br><span class="line">#access_log logs/host.access.log main;</span><br><span class="line">location ~ \.(html|js|css|png|gif)$ &#123;</span><br><span class="line">root D:/static; #可以是nginx 外部的文件</span><br><span class="line">&#125;</span><br><span class="line">location /&#123;</span><br><span class="line">proxy_pass http://nginxCluster; #集群配置</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="八、Nginx-负载均衡策略"><a href="#八、Nginx-负载均衡策略" class="headerlink" title="八、Nginx 负载均衡策略"></a>八、Nginx 负载均衡策略</h2><p>负载均衡是高可用网络基础架构的的一个关键组成部分，有了负载均衡，我们通常可以将我们的应用服务器部署多台，然后通过负载均衡将用户的请求分发到不同的服务器用来提高网站、应用、数据库或其他服务的性能以及可靠性</p><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p><strong>将服务器接收到的请求按照规则分发的过程，称为负载均衡</strong></p><h4 id="1-、轮询（默认）"><a href="#1-、轮询（默认）" class="headerlink" title="1 、轮询（默认）"></a>1 、轮询（默认）</h4><p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除</p><h5 id="2-、指定轮询几率"><a href="#2-、指定轮询几率" class="headerlink" title="2 、指定轮询几率"></a>2 、指定轮询几率</h5><p>weight 和访问比率成正比，用于后端服务器性能不均的情况默认选项，当 weight 不指定时，各服务器 weight 相同， (weight&#x3D;1)</p><p><img src="/posts/b99b2a28/image9.jpg" alt="负载权重"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数字越大，表明请求到的机会越大</span><br></pre></td></tr></table></figure><h5 id="3-、ip-hash"><a href="#3-、ip-hash" class="headerlink" title="3 、ip_hash"></a>3 、ip_hash</h5><p>每个请求按访问 ip 的 hash 值分配，这样同一客户端连续的 Web 请求都会被分发到同一服务器进行处理，可以解决 session 的问题。当后台服务器宕机时，会自动跳转到其它服务器</p><p><img src="/posts/b99b2a28/image8.jpg" alt="ip_hash"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">基于weight的负载均衡和基于ip_hash的负载均衡可以组合在一起使用</span><br></pre></td></tr></table></figure><h5 id="4-、url-hash（第三方）"><a href="#4-、url-hash（第三方）" class="headerlink" title="4 、url_hash（第三方）"></a>4 、url_hash（第三方）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_hash是nginx的第三方模块，nginx本身不支持，需要打补丁</span><br></pre></td></tr></table></figure><p>nginx 按访问 url 的 hash 结果来分配请求，使每个 url 定向到同一个后端服务器，后端服务器为缓存服务器、文件服务器、静态服务器时比较有效。缺点是当后端服务器宕机的时候，url_hash 不会自动跳转的其他缓存服务器，而是返回给用户一个 503 错误</p><h5 id="5-、fair（第三方）"><a href="#5-、fair（第三方）" class="headerlink" title="5 、fair（第三方）"></a>5 、fair（第三方）</h5><p>按后端服务器的响应时间来分配请求，响应时间短的优先分配</p><h2 id="九、集群-分布式环境下-session-处理策略"><a href="#九、集群-分布式环境下-session-处理策略" class="headerlink" title="九、集群&#x2F;分布式环境下 session 处理策略"></a>九、集群&#x2F;分布式环境下 session 处理策略</h2><p><strong>集群是个物理形态，分布式是个工作方式</strong></p><ul><li><p>分布式：一个业务分拆多个子业务，部署在不同的服务器上</p></li><li><p>集群：同一个业务，部署在多个服务器上</p></li></ul><h3 id="为什么要处理-session？"><a href="#为什么要处理-session？" class="headerlink" title="为什么要处理 session？"></a>为什么要处理 session？</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这个问题想必大多数朋友都知道，在搭建完集群或者分布式环境之后，如果不做任何处理的话，网站将频繁的出现用户未登录的现象。比</span><br><span class="line">如：集群中有A、B两台服务器，用户第一次访问网站时，Nginx将用户请求分发到A服务器，这时A服务器给用户创建了一个Session，</span><br><span class="line">当用户第二次访问网站时，假设Nginx将用户请求分发到了B服务器上，而这时B服务器并不存在用户的Session，所以就会出现用户未</span><br><span class="line">登录的情况，这对用户来说是不可忍受的。</span><br><span class="line">所以我们在搭建集群/分布式环境之后，必须考虑的一个问题就是用户访问产生的session如何处理，即session的共享机制</span><br></pre></td></tr></table></figure><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>我们将处理 Session 的方式大致分为三种</strong></p><ul><li><p>Session 保持（也有人叫黏性 Session）、</p></li><li><p>Session 复制</p></li><li><p>Session 共享</p></li></ul><h4 id="Session-保持（或者叫黏性-Session）"><a href="#Session-保持（或者叫黏性-Session）" class="headerlink" title="Session 保持（或者叫黏性 Session）"></a>Session 保持（或者叫黏性 Session）</h4><p>Session 保持（会话保持）就是将用户锁定到某一个服务器上。比如上面说的例子，用户第一次请求时，负载均衡器（Nginx）将用户的请求分发到了 A 服务器上，如果负载均衡器（Nginx）设置了 Session 保持的话，那么用户以后的每次请求都会分发到 A 服务器上，相当于把用户和 A 服务器粘到了一块，这就是 Session 保持的原理。Session 保持方案在所有的负载均衡器都有对应的实现。而且这是在负载均衡这一层就可以解决 Session 问题</p><p>**<em>优点</em>**：非常简单，不需要对 session 做任何处理。<br><strong><em>缺点</em><strong>： 1 、负责不均衡了：由于使用了 Session 保持，很显然就无法保证负载的均衡。 缺乏</strong>容错性</strong>：如果后端某台服务器宕机，那么这台服务器的 Session 丢失，被分配到这台服务请求的用户还是需要重新登录，所以没有彻底的解决问题</p><p>实现方式：以 Nginx 为例，在 upstream 模块配置 ip_hash 属性即可实现粘性 Session</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">容错性，是指软件检测应用程序所运行的软件或硬件中发生的错误并从错误中恢复的能力，通常可以从系统的可靠性、可用性、可测性等几个方面来衡量。</span><br></pre></td></tr></table></figure><h4 id="Session-复制"><a href="#Session-复制" class="headerlink" title="Session 复制"></a>Session 复制</h4><p>针对 Session 保持的容错性缺点，我们可以在所有服务器上都保存一份用户的 Session 信息。这种将每个服务器中的 Session 信息复制到其它服务器上的处理办法就称为会话复制。当任何一台服务器上的 session 发生改变时，该节点会把 session 的所有内容序列化，然后广播给所有其它节点，不管其他服务器需不需要 session，以此来保证 Session 同步</p><p><strong>优点</strong>：可容错，各个服务器间的 Session 能够实时响应。<br><strong>缺点</strong>：将 session 广播同步给成员，会对网络负荷造成一定压力</p><p><strong>实现方式：tomcat 本身已支持该功能</strong></p><p>tomcat 的会话复制分为两种</p><p>全局复制(DeltaManager)：复制会话中的变更信息到集群中的所有其他节点。 非全局复制（BackupManager）：它会把 Session 复制给一个指定的备份节点</p><p><img src="/posts/b99b2a28/image11.jpg" alt="tomcat"></p><h4 id="Session-共享"><a href="#Session-共享" class="headerlink" title="Session 共享"></a>Session 共享</h4><p>SpringSession+Redis 方式实现</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://angelxyj.github.io">许小墨</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://angelxyj.github.io/posts/b99b2a28.html">https://angelxyj.github.io/posts/b99b2a28.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://angelxyj.github.io" target="_blank">许小墨のBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/%E6%A0%87%E7%AD%BE/%E8%BF%90%E7%BB%B4/">运维</a><a class="post-meta__tags" href="/%E6%A0%87%E7%AD%BE/nginx/">nginx</a></div><div class="post_share"><div class="social-share" data-image="/img/17.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>感谢支持！</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/84e4a128.html" title="Docker 容器化解决方案"><img class="cover" src="/img/18.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Docker 容器化解决方案</div></div></a></div><div class="next-post pull-right"><a href="/posts/a9b91944.html" title="前端中间层（BFF）"><img class="cover" src="/img/17.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">前端中间层（BFF）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/d644b6dc.html" title="Nginx技术"><img class="cover" src="/img/15.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-21</div><div class="title">Nginx技术</div></div></a></div><div><a href="/posts/8439739f.html" title="nginx01-简介"><img class="cover" src="/img/15.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="title">nginx01-简介</div></div></a></div><div><a href="/posts/fdac2c1.html" title="nginx02-进阶篇"><img class="cover" src="/img/4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="title">nginx02-进阶篇</div></div></a></div><div><a href="/posts/ef07429c.html" title="nginx03-Rewrite功能配置"><img class="cover" src="/img/9.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="title">nginx03-Rewrite功能配置</div></div></a></div><div><a href="/posts/a1113e4c.html" title="nginx04-负载均衡"><img class="cover" src="/img/9.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="title">nginx04-负载均衡</div></div></a></div><div><a href="/posts/e8ac8fae.html" title="nginx05-服务器集群"><img class="cover" src="/img/6.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="title">nginx05-服务器集群</div></div></a></div></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div><div class="comment-switch"><span class="first-comment">Waline</span><span id="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.webp" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">许小墨</div><div class="author-info__description">全栈攻城狮的基本素养</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">198</div></a><a href="/%E6%A0%87%E7%AD%BE/"><div class="headline">标签</div><div class="length-num">183</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">42</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Angelxyj"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Angelxyj" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1440023258@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx"><span class="toc-number">1.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-Nginx"><span class="toc-number">1.1.</span> <span class="toc-text">一、什么是 Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-Nginx%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">二、为什么使用 Nginx？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%88High-Concurrency%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">高并发（High Concurrency）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%EF%BC%88High-Availability%EF%BC%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">高可用（High Availability）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD"><span class="toc-number">1.2.3.</span> <span class="toc-text">高性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.4.</span> <span class="toc-text">Nginx 特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.</span> <span class="toc-text">三、简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">反向代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">正向代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">1.3.3.</span> <span class="toc-text">正向代理和反向代理区别？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Nginx-%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.4.</span> <span class="toc-text">四、Nginx 下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Nginx-%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">五、Nginx 安装与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-number">1.5.1.</span> <span class="toc-text">Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-number">1.5.2.</span> <span class="toc-text">Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Nginx-%E6%BA%90"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">安装 Nginx 源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx-%E9%BB%98%E8%AE%A4%E7%9B%AE%E5%BD%95"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">Nginx 默认目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.3.</span> <span class="toc-text">Docker 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">基本安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%89%E5%8F%96-Nginx-%E9%95%9C%E5%83%8F"><span class="toc-number">1.5.3.1.1.</span> <span class="toc-text">拉取 Nginx 镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%88%97%E8%A1%A8%EF%BC%88%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0-nginx"><span class="toc-number">1.5.3.1.2.</span> <span class="toc-text">查看本地镜像列表（即可看到 nginx)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.3.1.3.</span> <span class="toc-text">运行容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="toc-number">1.5.3.1.4.</span> <span class="toc-text">安装成功</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">高级安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95"><span class="toc-number">1.5.3.2.1.</span> <span class="toc-text">创建目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%9D%E6%AC%A1%E5%9C%A8%E8%AF%A5%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%88%9B%E5%BB%BA%E4%B8%89%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95"><span class="toc-number">1.5.3.2.2.</span> <span class="toc-text">依次在该目录下创建三个文件目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.3.2.3.</span> <span class="toc-text">拷贝配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.3.2.4.</span> <span class="toc-text">修改配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E5%88%9B%E5%BB%BA-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.3.2.5.</span> <span class="toc-text">重新创建&#x2F;运行容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%87%8D%E6%96%B0%E8%AE%BF%E9%97%AE"><span class="toc-number">1.5.3.2.6.</span> <span class="toc-text">测试重新访问</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-compose-%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.4.</span> <span class="toc-text">Docker-compose 安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.6.</span> <span class="toc-text">配置文件描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx-conf-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.6.1.</span> <span class="toc-text">nginx.conf 配置文件描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">基本配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#events-%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">events 块配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">http 块配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server-%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">server 块配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server2-%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">server2 块配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#server3-%E5%9D%97%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.6.</span> <span class="toc-text">server3 块配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">六、应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">1.7.1.</span> <span class="toc-text">需求 1: 静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-2-%EF%BC%9A%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.7.2.</span> <span class="toc-text">需求 2 ：反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82-3-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">需求 3: 动静分离</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E9%9B%86%E7%BE%A4"><span class="toc-number">1.8.</span> <span class="toc-text">七、集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">1.8.1.</span> <span class="toc-text">集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E5%A6%82%E4%B8%8B"><span class="toc-number">1.8.2.</span> <span class="toc-text">完整如下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Nginx-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5"><span class="toc-number">1.9.</span> <span class="toc-text">八、Nginx 负载均衡策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.9.1.</span> <span class="toc-text">负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E3%80%81%E8%BD%AE%E8%AF%A2%EF%BC%88%E9%BB%98%E8%AE%A4%EF%BC%89"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">1 、轮询（默认）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E3%80%81%E6%8C%87%E5%AE%9A%E8%BD%AE%E8%AF%A2%E5%87%A0%E7%8E%87"><span class="toc-number">1.9.1.1.1.</span> <span class="toc-text">2 、指定轮询几率</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E3%80%81ip-hash"><span class="toc-number">1.9.1.1.2.</span> <span class="toc-text">3 、ip_hash</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E3%80%81url-hash%EF%BC%88%E7%AC%AC%E4%B8%89%E6%96%B9%EF%BC%89"><span class="toc-number">1.9.1.1.3.</span> <span class="toc-text">4 、url_hash（第三方）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E3%80%81fair%EF%BC%88%E7%AC%AC%E4%B8%89%E6%96%B9%EF%BC%89"><span class="toc-number">1.9.1.1.4.</span> <span class="toc-text">5 、fair（第三方）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E9%9B%86%E7%BE%A4-%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B-session-%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5"><span class="toc-number">1.10.</span> <span class="toc-text">九、集群&#x2F;分布式环境下 session 处理策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%A4%84%E7%90%86-session%EF%BC%9F"><span class="toc-number">1.10.1.</span> <span class="toc-text">为什么要处理 session？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.10.2.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-%E4%BF%9D%E6%8C%81%EF%BC%88%E6%88%96%E8%80%85%E5%8F%AB%E9%BB%8F%E6%80%A7-Session%EF%BC%89"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">Session 保持（或者叫黏性 Session）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-%E5%A4%8D%E5%88%B6"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">Session 复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-%E5%85%B1%E4%BA%AB"><span class="toc-number">1.10.2.3.</span> <span class="toc-text">Session 共享</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/3d9e6dac.html" title="004_鸿蒙如何实现自定义 Canvas？底层如何进行 Ui 的渲染 flutter skia"><img src="/img/14.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="004_鸿蒙如何实现自定义 Canvas？底层如何进行 Ui 的渲染 flutter skia"></a><div class="content"><a class="title" href="/posts/3d9e6dac.html" title="004_鸿蒙如何实现自定义 Canvas？底层如何进行 Ui 的渲染 flutter skia">004_鸿蒙如何实现自定义 Canvas？底层如何进行 Ui 的渲染 flutter skia</a><time datetime="2024-06-12T21:53:42.000Z" title="发表于 2024-06-12 21:53:42">2024-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4f9a63a7.html" title="003_了解过鸿蒙的 Napi 吗？如果我需要编译三方库如何链接？"><img src="/img/18.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="003_了解过鸿蒙的 Napi 吗？如果我需要编译三方库如何链接？"></a><div class="content"><a class="title" href="/posts/4f9a63a7.html" title="003_了解过鸿蒙的 Napi 吗？如果我需要编译三方库如何链接？">003_了解过鸿蒙的 Napi 吗？如果我需要编译三方库如何链接？</a><time datetime="2024-06-12T21:45:44.000Z" title="发表于 2024-06-12 21:45:44">2024-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dda8b3d8.html" title="002_音视频开发，鸿蒙实现播放器的 Ui 部分+底层部分"><img src="/img/jujingyi.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="002_音视频开发，鸿蒙实现播放器的 Ui 部分+底层部分"></a><div class="content"><a class="title" href="/posts/dda8b3d8.html" title="002_音视频开发，鸿蒙实现播放器的 Ui 部分+底层部分">002_音视频开发，鸿蒙实现播放器的 Ui 部分+底层部分</a><time datetime="2024-06-12T21:35:34.000Z" title="发表于 2024-06-12 21:35:34">2024-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1faddbca.html" title="001_组件化开发原理，鸿蒙组件化实现思路"><img src="/img/1.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="001_组件化开发原理，鸿蒙组件化实现思路"></a><div class="content"><a class="title" href="/posts/1faddbca.html" title="001_组件化开发原理，鸿蒙组件化实现思路">001_组件化开发原理，鸿蒙组件化实现思路</a><time datetime="2024-06-12T21:28:54.000Z" title="发表于 2024-06-12 21:28:54">2024-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6d6b0b0f.html" title="019_Gauge"><img src="/img/9.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="019_Gauge"></a><div class="content"><a class="title" href="/posts/6d6b0b0f.html" title="019_Gauge">019_Gauge</a><time datetime="2024-06-12T21:24:14.000Z" title="发表于 2024-06-12 21:24:14">2024-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2024 By 许小墨</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_60306931/category_12251529.html">blog</a>!<br><span>备案号：xxxxxx</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then((()=>{pangu.autoSpacingPage()}))}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach(((e,n)=>{const d=e.firstElementChild,r="mermaid-"+n,a="%%{init:{ 'theme':'"+t+"'}}%%\n"+d.textContent,i=mermaid.render(r,a);var m;"string"==typeof i?(m=i,d.insertAdjacentHTML("afterend",m)):i.then((({svg:e})=>{d.insertAdjacentHTML("afterend",e)}))}))},n=()=>{window.loadMermaid?t():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(t)};btf.addGlobalFn("themeChange",t,"mermaid"),window.pjax?n():document.addEventListener("DOMContentLoaded",n)})()</script><script>(()=>{let n=window.walineFn||null;const e=n=>{const e=n(Object.assign({el:"#waline-wrap",serverURL:"https://xuxiaomo-waline-i53b26l6n-xuxiaomo-xyj.vercel.app/",pageview:!1,dark:'html[data-theme="dark"]',path:window.location.pathname,comment:!1},null));btf.addGlobalFn("pjax",(()=>{e.destroy()}),"destroyWaline")},t=async()=>{if(n)e(n);else{await getCSS("https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css");const{init:t}=await import("https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js");n=t||Waline.init,e(n),window.walineFn=n}};btf.loadComment(document.getElementById("waline-wrap"),t)})()</script><script>(()=>{const t=function(){this.page.url="https://angelxyj.github.io/posts/b99b2a28.html",this.page.identifier="/posts/b99b2a28.html",this.page.title="Nginx合集"},e=()=>{window.DISQUS&&window.DISQUS.reset({reload:!0,config:t})};btf.addGlobalFn("themeChange",e,"disqus");const i=()=>{if(window.DISQUS)e();else{const t=document.createElement("script");t.src="https://xuxiaomo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),document.head.appendChild(t)}};window.loadOtherComment=i})()</script></div><script>window.addEventListener("load",(()=>{const e=e=>{let t="";if(e.length)for(let a=0;a<e.length;a++){t+="<div class='aside-list-item'>";{const n="src";t+=`<a href='${e[a].url}' class='thumbnail'><img ${n}='${e[a].avatar}' alt='${e[a].nick}'></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[a].url}' title='${e[a].content}'>${e[a].content}</a>\n        <div class='name'><span>${e[a].nick} / </span><time datetime="${e[a].date}">${btf.diffDate(e[a].date,!0)}</time></div>\n        </div></div>`}else t+="没有评论";let a=document.querySelector("#card-newest-comments .aside-list");a&&(a.innerHTML=t),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(a)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("waline-newest-comments");t?e(JSON.parse(t)):(async()=>{try{const t=await fetch("https://xuxiaomo-waline-i53b26l6n-xuxiaomo-xyj.vercel.app/api/comment?type=recent&count=6",{method:"GET"}),a=(await t.json()).data.map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.objectId,date:e.time||e.insertedAt};var t}));saveToLocal.set("waline-newest-comments",JSON.stringify(a),10/1440),e(a)}catch(e){console.error(e),document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"}})()}};t(),document.addEventListener("pjax:complete",t)}))</script><div class="aplayer no-destroy" data-id="8760365089" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-autoplay="false"></div><script defer src="/live2d-widget/autoload.js"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="true" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="//code.tidio.co/fpezrlnx14lzqj1yzhyigw0j3rkhtyzv.js" async></script><script>(()=>{{let i=!1;const d=()=>{window.tidioChatApi.hide(),i=!1},o=()=>{window.tidioChatApi.open(),window.tidioChatApi.show(),i=!0},t=()=>{window.tidioChatApi.hide(),window.tidioChatApi.on("close",d)};window.tidioChatApi?window.tidioChatApi.on("ready",t):document.addEventListener("tidioChat-ready",t),window.chatBtnFn=()=>{window.tidioChatApi&&(i?d():o())}}})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(btf.removeGlobalFnEvent("pjax"),btf.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 糖果屋上新啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍭查看新品🍬</span></a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"✨ 糖果屋上新啦！ 👉",backgroundColor:t,duration:5e5,pos:e,actionText:"🍭查看新品🍬",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script></div></body></html>